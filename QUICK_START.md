# Quick Start Guide

## What Was Built

Your attendance system now has a complete **role-based access control with admin approval workflow**:

✅ **Teachers** can signup with department info  
✅ **Students** can signup  
✅ **Admin** approves or rejects registrations  
✅ **Automatic Staff IDs** generated for teachers  
✅ **Automatic Registration Numbers** generated for students  
✅ **Email notifications** for all actions  
✅ **Separate dashboards** for each role  
✅ **Role-based login** with approval gate  

---

## File Changes Summary

### New Files Created
1. `teacher-signup.html` - Teacher registration form
2. `student-signup.html` - Student registration form
3. `teacher-dashboard.html` - Teacher dashboard (shows Staff ID)
4. `student-dashboard.html` - Student dashboard (shows Registration Number)
5. `admin-dashboard.html` - Admin approval panel
6. `README.md` - Full documentation

### Modified Files
1. `models/admin.js` - Updated schema with approval status
2. `utils/idGenerator.js` - Upgraded to ES6 exports
3. `server.js` - Added all new endpoints
4. `login.html` - Unified login for all roles

---

## How to Use

### 1️⃣ **First Time Setup**

Create `.env` file in root directory:
```env
MONGO_URI=your_mongodb_connection_string
JWT_SECRET=any_random_secret_key
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-gmail-app-password
```

Then start server:
```bash
node server.js
```

---

### 2️⃣ **Teacher Registration**

1. Go to `http://localhost:5000/teacher-signup.html`
2. Fill form:
   - Full Name
   - Email
   - Password
   - Phone Number
   - Department (e.g., Mathematics)
   - School Code (provided by admin)
3. Click "Create Account"
4. Account created with `approvalStatus: "pending"`

---

### 3️⃣ **Student Registration**

1. Go to `http://localhost:5000/student-signup.html`
2. Fill form:
   - Full Name
   - Email
   - Password
   - Phone Number
   - School Code
3. Click "Create Account"
4. Account created with `approvalStatus: "pending"`

---

### 4️⃣ **Admin Reviews & Approves**

1. Admin logs in at `http://localhost:5000/login.html`
2. Select "Admin" → Enter credentials
3. Redirected to `http://localhost:5000/admin-dashboard.html`
4. See all pending registrations
5. For each user:
   - **Approve**: Generates unique ID, sends email
   - **Reject**: Marks rejected, sends rejection email

---

### 5️⃣ **User Login**

1. Go to `http://localhost:5000/login.html`
2. Select "Student/Teacher"
3. Enter email and password
4. If approved → redirects to dashboard
5. If pending → shows "Account not yet approved" message

---

### 6️⃣ **Access Dashboards**

**Teacher Dashboard** - Shows:
- Welcome message with name
- Staff ID (generated by admin)
- Registration Number
- Account status
- Attendance records (empty initially)

**Student Dashboard** - Shows:
- Welcome message with name
- Registration Number (generated by admin)
- Account status
- Attendance records (empty initially)

**Admin Dashboard** - Allows:
- View pending users
- Filter by role
- Approve/Reject with reasons
- See real-time statistics

---

## Generated IDs

### Staff ID (Teachers)
```
Format: TCH-XXXXX
Example: TCH-12045
Generated: When admin approves teacher
```

### Registration Number (Students)
```
Format: STU-XXXXXXX
Example: STU-123456789
Generated: When admin approves student
```

---

## Email Flow

### 1. Teacher/Student Signup
→ **Email Sent:** "Registration Submitted"
- Confirms submission
- Says "Awaiting admin approval"

### 2. Admin Approves
→ **Email Sent:** "Account Approved!"
- Includes Staff ID or Registration Number
- Contains login link

### 3. Admin Rejects
→ **Email Sent:** "Registration Not Approved"
- Optional reason provided
- Directs to contact school admin

---

## Testing Checklist

### ✅ Test Teacher Flow
- [ ] Signup as teacher
- [ ] Check email inbox
- [ ] Login as admin, approve teacher
- [ ] Check teacher receives approval email with Staff ID
- [ ] Login as teacher
- [ ] View teacher dashboard
- [ ] See Staff ID displayed

### ✅ Test Student Flow
- [ ] Signup as student
- [ ] Check email inbox
- [ ] Login as admin, approve student
- [ ] Check student receives approval email
- [ ] Login as student
- [ ] View student dashboard
- [ ] See Registration Number displayed

### ✅ Test Admin Rejection
- [ ] Another teacher/student signup
- [ ] Login as admin, reject user
- [ ] Check rejection email received
- [ ] Try to login as rejected user → should fail

### ✅ Test Approval Gate
- [ ] Signup as student
- [ ] Try to login BEFORE approval → should show "not approved"
- [ ] Get admin approval
- [ ] Try to login AFTER approval → should work

---

## Database Schema

```javascript
// User Document
{
  _id: ObjectId,
  role: "teacher" | "student" | "admin",
  fullName: "John Doe",
  email: "john@example.com",
  password: "hashed_password",
  phoneNumber: "+1234567890",
  department: "Mathematics", // teachers only
  schoolId: ObjectId,
  
  // Generated IDs
  staffId: "TCH-12045", // teachers
  registrationNumber: "STU-123456789", // students
  
  // Approval Workflow
  approvalStatus: "pending" | "approved" | "rejected",
  approvedAt: Date,
  approvedBy: ObjectId, // admin who approved
  
  // Account
  status: "active" | "inactive",
  createdAt: Date
}
```

---

## API Endpoints Quick Reference

### For Teachers/Students

```
POST /teacherSignup → Create teacher account
POST /studentSignup → Create student account
POST /userLogin → Login and get token
GET /userDashboard/:userId → Get user data
```

### For Admins

```
GET /pendingUsers/:adminEmail → Get pending registrations
POST /approveUser → Approve and generate ID
POST /rejectUser → Reject registration
POST /adminLogin → Admin login
```

---

## LocalStorage Keys (Frontend)

```javascript
// For Teachers/Students
localStorage.setItem("userToken", jwt_token)
localStorage.setItem("userId", user_id)
localStorage.setItem("userRole", "teacher" | "student")
localStorage.setItem("userEmail", email)

// For Admin
localStorage.setItem("adminToken", jwt_token)
localStorage.setItem("adminEmail", email)
```

---

## Common Issues & Solutions

| Problem | Solution |
|---------|----------|
| "School code not found" | Verify school was registered and code is correct |
| "Email already registered" | Use different email or reset password |
| "Cannot approve user" | Ensure logged in as admin, user exists |
| "Email not sending" | Check Gmail app password, EMAIL_USER/PASS in .env |
| "Token expired" | Login again, localStorage cleared after session |

---

## Next Steps

1. **Run the server**: `node server.js`
2. **Test teacher flow**: Create account → Wait approval → Login
3. **Test student flow**: Create account → Wait approval → Login
4. **Test admin flow**: Approve/reject users, see IDs generated
5. **Expand features**: Add attendance marking, reports, etc.

---

## Need Help?

Check:
1. Server console logs (terminal)
2. Browser console (F12 → Console tab)
3. Network tab to see API calls
4. Email inbox for verification emails

